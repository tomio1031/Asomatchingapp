<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asotalk</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        .field {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 5% 0 0 0;
        }
        .name {
            margin: 0 10% 0 0;
        }
        .name_field {
            height: 100%;
            width: 20vh;
        }
        .top {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin: 5% 0 0 0;
            align-items: center;
        }
        .back {
            font-size: 200%;
            padding: 0 0 0 5%;
        }
        .pagename {
            font-size: 120%;
        }
        .done {
            padding: 0 5% 0 0;
            font-size: 110%;
        }
        .intrText {
            margin: 5% 0 0 5%;
        }
        .area {
            margin: 5% auto 0 auto;
            display: flex;
            width: 80%;
            height: 20vh;
        }
        .bottom-menu {
    position:fixed;
    bottom:0px;
    display: flex;
    justify-content: center;
    padding: 10px;
}
  
  .bottom-menu a {
    text-decoration: none;
    color: #333;
    padding: 10px;
    margin: 0 20px;
}
    </style>
</head>

<body>
    <div class="top">
        <div class="back" onclick="locationp()">←</div>
        <div class="pagename">設定</div>
        <button id="submit-btn" class="done">編集</button>
    </div>
    <div class="field">
        <div class="name">名前</div>
    <input type="text" id="name" class="name_field">
</div>
<div class="field">
    <div class="name">年齢</div>
    <input type="text" id="age" class="name_field">
</div>
<div class="field">
    <div class="name">趣味</div>
    <select id="hobby_id" name="hobby_id" class="name_field">
        <option value="1">選択してください</option>
        <option value="2">食事</option>
        <option value="3">カフェ</option>
        <option value="4">ゲーム</option>
    </select>
</div>
<div class="intrText">自己紹介</div>

    <textarea id="introduction" name="introduction" class="area"></textarea>
    <div class="bottom-menu">
        <a href="http://learning-sql.kikirara.jp/home.html">
            <!-- <div class="Your"> -->
                <img src="http://learning-sql.kikirara.jp/uploads/ab.png" width="30px" height="auto">
            <!-- </div> -->
        </a>

        <a href="http://learning-sql.kikirara.jp/historyy.html">
            <!-- <button class="List"> -->
                <img src="http://learning-sql.kikirara.jp/uploads/ls2.png" width="30px" height="auto">
            <!-- </button> -->
        </a>
        
        <a href="http://learning-sql.kikirara.jp/profilee.html">
            <!-- <button class="My"> -->
                <img src="http://learning-sql.kikirara.jp/uploads/p.png" width="30px" height="auto">
            <!-- </button> -->
        </a>
      </div>  
    <script>
        function locationp() {
            location.href = 'http://learning-sql.kikirara.jp/profilee.html'
        }
        var student_id = localStorage.getItem('student_id');
        window.onload = function () {
            const userData = {
                name: '',
                age: '',
                hobby_id: '',
                introduction: ''
            };

            // テキストからIDへのマッピング
            const hobbyMap = {
                "選択してください": 1,
                "食事": 2,
                "カフェ": 3,
                "ゲーム": 4
            };

            const formData = new FormData();
            formData.append('student_id', student_id);
            formData.append('profile', '');

            axios.post('http://learning-sql.kikirara.jp/main.php', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                })
                .then(function (response) {
                    console.log(response);
                    userData.name = response.data.Data.name;
                    userData.age = response.data.Data.age;
                    userData.hobby_id = response.data.Data.hobby;
                    userData.introduction = response.data.Data.introduction;
                    // console.log(userData);

                    // ページのロード時に入力フィールドを初期化
                    Object.keys(userData).forEach(key => {
                        const inputElement = document.getElementById(key);
                        if (inputElement) {
                            if (inputElement.nodeName === 'SELECT') {
                                const options = inputElement.options;
                                for (let i = 0; i < options.length; i++) {
                                    if (options[i].text === userData[key]) {
                                        options[i].selected = true;
                                        break;
                                    }
                                }
                            } else {
                                inputElement.value = userData[key];
                            }
                        }
                    });
                })
                .catch(function (error) {
                    console.log(error);
                });

            document.getElementById('submit-btn').addEventListener('click', function () {
                const formData = new FormData();
                const name = document.getElementById('name').value;
                const age = document.getElementById('age').value;
                const hobbyElement = document.getElementById('hobby_id');
                const hobby_id = hobbyElement.options[hobbyElement.selectedIndex].value;
                const introduction = document.getElementById('introduction').value;

                formData.append("profile_edit", '');
                formData.append("student_id", student_id);
                formData.append("name", name);
                formData.append("age", age);
                formData.append("hobby_id", hobby_id);
                formData.append("introduction", introduction);

                axios.post('http://learning-sql.kikirara.jp/main.php', formData, {
                        headers: {
                            'Content-Type': 'multipart/form-data'
                        }
                    })
                    .then(function (response) {
                        console.log(response);
                        location.reload();
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            });

        };
    </script>
</body>


</html>