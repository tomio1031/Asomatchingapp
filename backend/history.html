<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
</head>
<style>
    .button {
        width: 90%;
        display: flex;
        margin: 5% auto 0 auto;
        background-color: transparent;
        align-items: center;
        border-bottom: 1px solid black;
        padding: 0 0 2% 0;
    }

    .image {
        width: 10vh;
    }

    .name {
        margin: 0 0 0 10%;
        font-size: 200%;
    }
    .title {
        text-align: center;
        font-size: 150%;
    }
</style>

<body>
<div class="title">Message</div>

    <!-- JSONを扱うためのCDN -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        window.onload = function () {
            const formData = new FormData();

            formData.append('student_id', 2);
            formData.append('history', '');

            axios.post('http://learning-sql.kikirara.jp/main.php', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                })
                .then(function (response) {
                    const matchedStudents = response.data.Matched;
                    matchedStudents.forEach(function (matchedStudent) {
                        getProfile(matchedStudent.matched_id);
                    });
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function getProfile(studentId) {
            const formData = new FormData();

            formData.append('student_id', studentId);
            formData.append('profile', '');

            axios.post('http://learning-sql.kikirara.jp/main.php', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                })
                .then(function (response) {
                    // console.log(response.data.Data.name);
                    // console.log(response.data.Dataprofile_image);
                    const name = response.data.Data.name;
                    const profileImage = response.data.Data.profile_image;

                    // ボタンを作成します。
                    let btn = document.createElement("button");
                    btn.className = "button"; // ボタンにクラス名を付与します。

                    // 画像を表示するimg要素を作成し、ボタンに追加します。
                    let img = document.createElement("img");
                    img.src = profileImage; // 画像のURLを設定します。
                    img.className = "image"; // img要素にクラス名を付与します。
                    btn.appendChild(img); // img要素をボタンに追加します。

                    // 名前を表示するdiv要素を作成し、ボタンに追加します。
                    let div = document.createElement("div");
                    div.textContent = name; // 名前を設定します。
                    div.className = "name"; // div要素にクラス名を付与します。
                    btn.appendChild(div); // div要素をボタンに追加します。

                    // ボタンをHTMLに追加します。
                    // ここでは、body要素の最後に追加します。
                    document.body.appendChild(btn);
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    </script>
</body>

</html>
